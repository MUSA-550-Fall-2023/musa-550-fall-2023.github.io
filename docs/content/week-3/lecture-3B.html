<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Geospatial Data Science in Python - Week 3B: Intro to Geospatial Data Analysis with GeoPandas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../files/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Geospatial Data Science in Python</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-schedule" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Schedule</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-schedule">    
        <li>
    <a class="dropdown-item" href="../../schedule/401.html" rel="" target="">
 <span class="dropdown-text">Section 401</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../schedule/402.html" rel="" target="">
 <span class="dropdown-text">Section 402</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../content/index.html" rel="" target="">
 <span class="menu-text">Content</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assignments" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Assignments</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-assignments">    
        <li>
    <a class="dropdown-item" href="../../assignment/overview.html" rel="" target="">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assignment/401/schedule.html" rel="" target="">
 <span class="dropdown-text">Section 401</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../assignment/402/schedule.html" rel="" target="">
 <span class="dropdown-text">Section 402</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../resource/index.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-box-arrow-up-right"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/MUSA-550-Fall-2023">
            GitHub
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://canvas.upenn.edu/courses/1740535">
            Canvas
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://edstem.org/us/courses/42616/discussion/">
            Ed Discussion
            </a>
          </li>
      </ul>
    </div>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 3B: Intro to Geospatial Data Analysis with GeoPandas</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<ul>
<li>Section 401</li>
<li>Sep 20, 2023</li>
</ul>
<section id="housekeeping" class="level2">
<h2 class="anchored" data-anchor-id="housekeeping">Housekeeping</h2>
<ul>
<li><a href="https://github.com/MUSA-550-Fall-2023/assignment-1">Homework #1</a> due on Monday (9/25)</li>
<li><a href="https://github.com/MUSA-550-Fall-2023/assignment-2">Homework #2</a> will be assigned same day</li>
<li>Choose a dataset to visualize and explore
<ul>
<li><a href="https://opendataphilly.org">OpenDataPhilly</a> or one your choosing</li>
<li>Email me if you want to analyze one that’s not on OpenDataPhilly</li>
</ul></li>
</ul>
</section>
<section id="agenda-for-today" class="level2">
<h2 class="anchored" data-anchor-id="agenda-for-today">Agenda for today</h2>
<ul>
<li>Introduction to GeoPandas and vector data</li>
<li>Spatial relationships and joins</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We’ll continue geospatial analysis next week, with: - Visualization for geospatial data - Demo: 311 requests by neighborhood in Philadelphia - Exercise: Property assessments by neighborhood</p>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's setup the imports we'll need first</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-1-vector-geospatial-data-in-python" class="level2">
<h2 class="anchored" data-anchor-id="part-1-vector-geospatial-data-in-python">Part 1: Vector geospatial data in Python</h2>
<ul>
<li><strong>Vector</strong> refers to <strong>discrete geometric entities</strong></li>
<li>The <a href="https://en.wikipedia.org/wiki/Open_Geospatial_Consortium">Open Geospatial Consortium</a> has standardized a set of <a href="https://en.wikipedia.org/wiki/Simple_Features"><strong>simple features</strong></a></li>
<li>Includes points, lines, and polygons</li>
</ul>
<center>
<img src="imgs/simple-features.png" width="600">
</center>
<p><a href="https://www.earthdatascience.org/workshops/gis-open-source-python/intro-vector-data-python/">Source</a></p>
<section id="a-couple-of-terminology-notes" class="level3">
<h3 class="anchored" data-anchor-id="a-couple-of-terminology-notes">A couple of terminology notes</h3>
<ul>
<li>A <strong>feature</strong> refers to both the geometry and attributes of specific piece of vector data</li>
<li>A <strong>feature collection</strong> is a list, or collection, of features</li>
</ul>
<p>Both terms are very common in Python geospatial software.</p>
</section>
<section id="common-formats-for-vector-datasets" class="level3">
<h3 class="anchored" data-anchor-id="common-formats-for-vector-datasets">Common formats for vector datasets</h3>
<section id="a-shapefile" class="level4">
<h4 class="anchored" data-anchor-id="a-shapefile">1. A shapefile</h4>
<p>Actually several files with the same common prefix.</p>
<p>Mandatory files:</p>
<ul>
<li><strong>.shp</strong>: the file containing the geometries</li>
<li><strong>.shx</strong>: the file that indexes the geometry</li>
<li><strong>.dbf</strong>: tabular data format storing the attributes for each geometry</li>
</ul>
<p>And many optional files for documentation, projection information, etc.</p>
<p>Let’s take a look at an example shapefile:</p>
<p>We’ll use the <code>%ls</code> command to <em>list</em> out all of the files in an example shapefile in the <code>data/</code> folder</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>ls <span class="st">"data/ne_110m_admin_0_countries/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ne_110m_admin_0_countries.cpg  ne_110m_admin_0_countries.shp
ne_110m_admin_0_countries.dbf  ne_110m_admin_0_countries.shx
ne_110m_admin_0_countries.prj</code></pre>
</div>
</div>
</section>
<section id="the-geojson-file" class="level4">
<h4 class="anchored" data-anchor-id="the-geojson-file">2. The GeoJSON file</h4>
<ul>
<li>Stores simple features in a JSON format</li>
<li>Arose due to the prevalence of the JSON format, especially on the web</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="Additional GeoJSON resources">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Additional GeoJSON resources
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>GitHub lets you view GeoJSON files natively. See <a href="https://github.com/MUSA-550-Fall-2023/week-3/blob/main/data/Zipcodes_Poly.geojson">Philadelphia ZIP Codes</a> in the <code>data/</code> folder of this week’s repo.</li>
<li>http://geojson.io provides interactive creation and viewing of small GeoJSON files</li>
</ul>
</div>
</div>
</section>
</section>
<section id="analyzing-vector-data-with-geopandas" class="level3">
<h3 class="anchored" data-anchor-id="analyzing-vector-data-with-geopandas">Analyzing vector data with GeoPandas</h3>
<p><code>geopandas</code> provides a simple, intuitive for the main types of geospatial vector file formats</p>
<p><img src="imgs/geopandas-logo.jpeg" class="img-fluid" width="600"></p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The import statement</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Example:</strong> Let’s load a shape file of countries in the world…</p>
<p><a href="http://www.naturalearthdata.com/downloads/110m-cultural-vectors/110m-admin-0-countries/">Source: Natural Earth Data</a></p>
<p>We can use the <a href="https://geopandas.org/docs/reference/api/geopandas.read_file.html">read_file()</a> function to read shapefiles and GeoJSON files.</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the shape file, giving the name of the directory</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> gpd.read_file(<span class="st">"./data/ne_110m_admin_0_countries"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>countries.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AFG</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>34124811.0</td>
<td>64080.0</td>
<td>POLYGON ((61.21082 35.65007, 62.23065 35.27066...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AGO</td>
<td>Angola</td>
<td>Africa</td>
<td>29310273.0</td>
<td>189000.0</td>
<td>MULTIPOLYGON (((23.90415 -11.72228, 24.07991 -...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ALB</td>
<td>Albania</td>
<td>Europe</td>
<td>3047987.0</td>
<td>33900.0</td>
<td>POLYGON ((21.02004 40.84273, 20.99999 40.58000...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ARE</td>
<td>United Arab Emirates</td>
<td>Asia</td>
<td>6072475.0</td>
<td>667200.0</td>
<td>POLYGON ((51.57952 24.24550, 51.75744 24.29407...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ARG</td>
<td>Argentina</td>
<td>South America</td>
<td>44293293.0</td>
<td>879400.0</td>
<td>MULTIPOLYGON (((-66.95992 -54.89681, -67.56244...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(countries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>geopandas.geodataframe.GeoDataFrame</code></pre>
</div>
</div>
</section>
<section id="whats-a-geodataframe" class="level3">
<h3 class="anchored" data-anchor-id="whats-a-geodataframe">What’s a <code>GeoDataFrame</code>?</h3>
<p>Just like a <code>DataFrame</code> but with a new, special <code>geometry</code> column:</p>
<p><img src="imgs/geodataframe.svg"></p>
<p>Print out the first 10 entires of the “geometry” column:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>countries[<span class="st">"geometry"</span>].head(n<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>0    POLYGON ((61.21082 35.65007, 62.23065 35.27066...
1    MULTIPOLYGON (((23.90415 -11.72228, 24.07991 -...
2    POLYGON ((21.02004 40.84273, 20.99999 40.58000...
3    POLYGON ((51.57952 24.24550, 51.75744 24.29407...
4    MULTIPOLYGON (((-66.95992 -54.89681, -67.56244...
5    POLYGON ((43.58275 41.09214, 44.97248 41.24813...
6    MULTIPOLYGON (((-59.57209 -80.04018, -59.86585...
7    POLYGON ((68.93500 -48.62500, 69.58000 -48.940...
8    MULTIPOLYGON (((145.39798 -40.79255, 146.36412...
9    POLYGON ((16.97967 48.12350, 16.90375 47.71487...
Name: geometry, dtype: geometry</code></pre>
</div>
</div>
<p>Take a look at the first geometry polygon by using the <code>.iloc[]</code> selector:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>countries[<span class="st">'geometry'</span>].iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<p><img src="lecture-3B_files/figure-html/cell-9-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="we-can-still-leverage-the-power-of-pandas" class="level3">
<h3 class="anchored" data-anchor-id="we-can-still-leverage-the-power-of-pandas">We can still leverage the power of <code>pandas</code>…</h3>
<p>Calculate the total world population:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>countries[<span class="st">"pop_est"</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e9</span>  <span class="co"># In billions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>7.383089462</code></pre>
</div>
</div>
<p>Calculate the total population on each continent:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> countries.groupby(<span class="st">"continent"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>grouped</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x17f287b80&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Remember">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Remember
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>groupby()</code> function does not return a <code>DataFrame</code> — you need to call <code>sum()</code>, <code>mean()</code> etc, or <code>apply()</code> a function to get your desired result!</p>
</div>
</div>
<p>Access the “pop_est” column from the groupby variable (“grouped”) and then call the <code>.sum()</code> function to calculate our desired statistic:</p>
<div class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>pop_by_continent <span class="op">=</span> grouped[<span class="st">"pop_est"</span>].<span class="bu">sum</span>()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>pop_by_continent</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>continent
Africa                     1.219176e+09
Antarctica                 4.050000e+03
Asia                       4.389145e+09
Europe                     7.463985e+08
North America              5.730421e+08
Oceania                    3.678284e+07
Seven seas (open ocean)    1.400000e+02
South America              4.185407e+08
Name: pop_est, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort values</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>pop_by_continent.sort_values(ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Output sorted values from cell</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>pop_by_continent <span class="op">/</span> <span class="fl">1e9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>continent
Asia                       4.389145e+00
Africa                     1.219176e+00
Europe                     7.463985e-01
North America              5.730421e-01
South America              4.185407e-01
Oceania                    3.678284e-02
Antarctica                 4.050000e-06
Seven seas (open ocean)    1.400000e-07
Name: pop_est, dtype: float64</code></pre>
</div>
</div>
<p>Filter the data frame based on a boolean selection:</p>
<div class="cell" data-tags="[]" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is the country name USA?</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>is_USA <span class="op">=</span> countries[<span class="st">"name"</span>] <span class="op">==</span> <span class="st">"United States of America"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>is_USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0      False
1      False
2      False
3      False
4      False
       ...  
172    False
173    False
174    False
175    False
176    False
Name: name, Length: 177, dtype: bool</code></pre>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the row with USA</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>USA <span class="op">=</span> countries.loc[is_USA]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">168</td>
<td>USA</td>
<td>United States of America</td>
<td>North America</td>
<td>326625791.0</td>
<td>18560000.0</td>
<td>MULTIPOLYGON (((-122.84000 49.00000, -120.0000...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>USA.squeeze().geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<p><img src="lecture-3B_files/figure-html/cell-16-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Reminder: the squeeze() function">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reminder: the squeeze() function
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>squeeze()</code> function does just one it sounds like: if you have a DataFrame with only one row, it will “squeeze” the row dimension by removing it, returning just a Series object:</p>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Squeeze</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>USA <span class="op">=</span> USA.squeeze()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the types</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The type of USA is: "</span>, <span class="bu">type</span>(USA))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The type of USA is:  &lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>iso_a3                                                      USA
name                                   United States of America
continent                                         North America
pop_est                                             326625791.0
gdp_md_est                                           18560000.0
geometry      MULTIPOLYGON (((-122.84000000000005 49.0000000...
Name: 168, dtype: object</code></pre>
</div>
</div>
<p>The simple features (Lines, Points, Polygons) are implemented by the <a href="https://shapely.readthedocs.io/en/stable/manual.html">shapely</a> library</p>
<div class="cell" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>iso_a3                                                      USA
name                                   United States of America
continent                                         North America
pop_est                                             326625791.0
gdp_md_est                                           18560000.0
geometry      MULTIPOLYGON (((-122.84000000000005 49.0000000...
Name: 168, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(USA.geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>shapely.geometry.multipolygon.MultiPolygon</code></pre>
</div>
</div>
<p>JupyterLab renders <code>shapely</code> geometries automatically:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a mini USA</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>USA.geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<p><img src="lecture-3B_files/figure-html/cell-20-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="how-does-geopandas-handle-coordinate-systems-and-map-projections" class="level3">
<h3 class="anchored" data-anchor-id="how-does-geopandas-handle-coordinate-systems-and-map-projections">How does <code>geopandas</code> handle coordinate systems and map projections?</h3>
<p>A <strong>coordinate reference system</strong> (CRS) relates the position of a geometry object on the spherical earth to its two-dimensional coordinates.</p>
<p>A <code>GeoDataFrame</code> or <code>GeoSeries</code> has a <code>.crs</code> attribute which specifies the coordinate reference system.</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>countries.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
</section>
<section id="the-epsg4326-crs" class="level3">
<h3 class="anchored" data-anchor-id="the-epsg4326-crs">The EPSG=4326 CRS</h3>
<ul>
<li>EPSG 4326 is known as WGS 84 where <code>x</code> and <code>y</code> are longitude and latitude.</li>
<li>It is is the default coordinate system for GPS systems.</li>
<li>It’s also known as <em>Plate Carrée</em> or <em>equirectangular</em></li>
</ul>
</section>
<section id="how-to-plot-all-of-the-geometries-at-once" class="level3">
<h3 class="anchored" data-anchor-id="how-to-plot-all-of-the-geometries-at-once">How to plot all of the geometries at once?</h3>
<p>Use the <code>plot()</code> function to get a quick and dirty plot of all of the geometry features.</p>
<p><strong>Note:</strong> the <code>plot()</code> returns the current maplotlib axes, allowing you to format the chart after plotting.</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and axes</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the countries on our axes</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> countries.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Equirectangular Projection"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<center>
<img src="imgs/equirectangular.png" width="800">
</center>
</section>
<section id="can-we-convert-to-other-coordinate-systems" class="level3">
<h3 class="anchored" data-anchor-id="can-we-convert-to-other-coordinate-systems">Can we convert to other coordinate systems?</h3>
<p>Use the <code>df.to_crs()</code> function! The most well-known projections can be specified by their EPSG code.</p>
<p>Geopandas documentation on re-projecting: <a href="https://geopandas.org/projections.html#re-projecting">Managing Projections</a></p>
<section id="lets-convert-to-the-mercator-projection" class="level4">
<h4 class="anchored" data-anchor-id="lets-convert-to-the-mercator-projection">Let’s convert to the Mercator projection</h4>
<p><a href="http://spatialreference.org/ref/epsg/wgs-84-world-mercator/">EPSG code: 3395</a></p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Antartica, as the Mercator projection</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cannot deal with the poles</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>no_antarctica <span class="op">=</span> countries.loc[(countries[<span class="st">"name"</span>] <span class="op">!=</span> <span class="st">"Antarctica"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Two ways to specify the EPSG code</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>countries_mercator <span class="op">=</span> no_antarctica.to_crs(epsg<span class="op">=</span><span class="dv">3395</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively:</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># countries_mercator = no_antartica.to_crs("EPSG:3395")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>countries_mercator.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AFG</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>34124811.0</td>
<td>64080.0</td>
<td>POLYGON ((6813956.990 4227673.562, 6927484.435...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AGO</td>
<td>Angola</td>
<td>Africa</td>
<td>29310273.0</td>
<td>189000.0</td>
<td>MULTIPOLYGON (((2660998.216 -1305442.810, 2680...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ALB</td>
<td>Albania</td>
<td>Europe</td>
<td>3047987.0</td>
<td>33900.0</td>
<td>POLYGON ((2339940.185 4961221.199, 2337708.178...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ARE</td>
<td>United Arab Emirates</td>
<td>Asia</td>
<td>6072475.0</td>
<td>667200.0</td>
<td>POLYGON ((5741805.754 2765811.385, 5761611.935...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ARG</td>
<td>Argentina</td>
<td>South America</td>
<td>44293293.0</td>
<td>879400.0</td>
<td>MULTIPOLYGON (((-7453944.198 -7306880.704, -75...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Take a look at the values in the “geometry” column above. The magnitude of the coordinates changed! This is a quick and easy way to tell if the re-projection worked properly!</p>
</div>
</div>
</section>
<section id="now-lets-plot-it" class="level4">
<h4 class="anchored" data-anchor-id="now-lets-plot-it">Now let’s plot it!</h4>
<p>The easy way…with geopandas built-in <code>plot()</code> function</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the figure and axes</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use built-in plot() of the GeoDataFrame</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> countries_mercator.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Mercator Projection"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<center>
<img src="imgs/mercator.png" width="800">
</center>
</section>
<section id="which-one-is-your-favorite" class="level4">
<h4 class="anchored" data-anchor-id="which-one-is-your-favorite">Which one is your favorite?</h4>
<p><img src="https://imgs.xkcd.com/comics/map_projections.png" class="img-fluid"></p>
<p><a href="https://xkcd.com/977/">Source: xkcd</a></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Tip: Choosing the right CRS">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip: Choosing the right CRS
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>For city-based data, the Web Mercator CRS (<a href="https://epsg.io/3857">EPSG=3857</a>) is best. This CRS became popular after Google Maps adopted it.</li>
<li>You can also use a CRS specific to individual states, e.g., the <a href="https://epsg.io/2272">PA State Plane EPSG=2272</a> is a good option for Philadelphia</li>
</ul>
</div>
</div>
</section>
</section>
<section id="lets-load-the-city-limits-for-philadelphia" class="level3">
<h3 class="anchored" data-anchor-id="lets-load-the-city-limits-for-philadelphia">Let’s load the city limits for Philadelphia</h3>
<p>We’ll use the provided <code>City_Limits</code> shape file in the <code>data/</code> folder</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>city_limits <span class="op">=</span> gpd.read_file(<span class="st">"./data/City_Limits"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>city_limits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">Shape__Are</th>
<th data-quarto-table-cell-role="th">Shape__Len</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.038911</td>
<td>1.259687</td>
<td>POLYGON ((-75.01497 40.13793, -75.01456 40.137...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="whats-the-crs" class="level4">
<h4 class="anchored" data-anchor-id="whats-the-crs">What’s the CRS?</h4>
<p>Use the <code>.crs</code> attribute to find out!</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>city_limits.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<p>Plot it with the EPSG=4326 CRS:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create our figure and axes</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>city_limits.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Format</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Equirectangular"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()  <span class="co"># This will remove the axes completely</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)  <span class="co"># This forces an equal aspect ratio</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This is <em>not</em> what Philadelphia looks like..</p>
<p>Let’s try EPSG=3857 instead:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the figure</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to EPSG:3857</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>city_limits_3857 <span class="op">=</span> city_limits.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot and format</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>city_limits_3857.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Web Mercator"</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Important">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The equirectangular CRS (EPSG=4326) is often used by default and will make cities appear wider and flatter than they really are.</p>
</div>
</div>
</section>
<section id="saving-geodataframes" class="level4">
<h4 class="anchored" data-anchor-id="saving-geodataframes">Saving GeoDataFrames</h4>
<p>Use the <code>to_file()</code> function and specify the driver.</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ESRI shape file</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>city_limits_3857.to_file(<span class="st">"./data/city_limits_3857"</span>, driver<span class="op">=</span><span class="st">"Shapefile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GeoJSON is also an option</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>city_limits_3857.to_file(<span class="st">"./data/city_limits_3857.geojson"</span>, driver<span class="op">=</span><span class="st">"GeoJSON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-about-as-a-csv-file" class="level4">
<h4 class="anchored" data-anchor-id="how-about-as-a-csv-file">How about as a CSV file?</h4>
<p>Yes, but reading requires more work…</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save a csv file</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>city_limits_3857.to_csv(<span class="st">"./data/city_limits_3857.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"./data/city_limits_3857.csv"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">Shape__Are</th>
<th data-quarto-table-cell-role="th">Shape__Len</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.038911</td>
<td>1.259687</td>
<td>POLYGON ((-8350627.97509646 4886006.88680784, ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="looks-similar" class="level4">
<h4 class="anchored" data-anchor-id="looks-similar">Looks similar…</h4>
<p><strong>But,</strong> the “geometry” column is just stored as a string…it’s not a shapely Polygon</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df.geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>0    POLYGON ((-8350627.97509646 4886006.88680784, ...
Name: geometry, dtype: object</code></pre>
</div>
</div>
</section>
<section id="use-shapely-to-parse-the-string-version-of-the-polygons" class="level4">
<h4 class="anchored" data-anchor-id="use-shapely-to-parse-the-string-version-of-the-polygons">Use <code>shapely</code> to parse the string version of the polygons</h4>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely <span class="im">import</span> wkt</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># wkt.loads will convert from string to Polygon object</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"geometry"</span>] <span class="op">=</span> df[<span class="st">"geometry"</span>].<span class="bu">apply</span>(wkt.loads)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df.geometry.iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<p><img src="lecture-3B_files/figure-html/cell-37-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Success!</p>
</section>
<section id="converting-from-a-dataframe-to-a-geodataframe" class="level4">
<h4 class="anchored" data-anchor-id="converting-from-a-dataframe-to-a-geodataframe">Converting from a DataFrame to a GeoDataFrame</h4>
<p>We can initialize the GeoDataFrame directly from a DataFrame but we need to specify <strong>two things</strong>:</p>
<ol type="1">
<li>The name of the “geometry” column</li>
<li>The CRS of the “geometry” column</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled" title="Watch out!">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Watch out!
</div>
</div>
<div class="callout-body-container callout-body">
<p>The CRS that you specify when you create the GeoDataFrame must match the CRS of the data. It is <strong>not</strong> the CRS that you wish the data was in. If you would like to convert to a different CRS, you’ll need to call the <code>.to_crs()</code> after creating your GeoDataFrame.</p>
</div>
</div>
<p>In this case, the geometry column was saved in Web Mercator EPSG=3857</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make specifying the name of the geometry column and CRS</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.GeoDataFrame(df, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span><span class="st">"EPSG:3857"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now plot</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="lets-convert-back-to-4326-and-plot" class="level4">
<h4 class="anchored" data-anchor-id="lets-convert-back-to-4326-and-plot">Let’s convert back to 4326 and plot</h4>
<p>The tilt should be a bit more obvious now…</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> gdf.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>).plot(facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>I didn’t use <code>plt.subplots()</code> here to create a figure/axes – I let geopandas automatically make one</li>
<li>I’ve chained together the <code>to_crs()</code> and <code>.plot()</code> functions in one line</li>
<li>The <code>.plot()</code> function returns the axes object that geopandas used to plot —&nbsp;this lets you customizes the axes after plotting</li>
</ul>
</div>
</div>
</section>
</section>
<section id="so-when-should-you-use-geopandas" class="level3">
<h3 class="anchored" data-anchor-id="so-when-should-you-use-geopandas">So, when should you use GeoPandas?</h3>
<ul>
<li>For exploratory data analysis and visualization, including in Jupyter notebooks</li>
<li>Pre-processing data to be fed into a desktop GIS program</li>
<li>For compact, readable, and reproducible code</li>
<li>If you’re comfortable with Pandas and/or R data frames.</li>
</ul>
</section>
<section id="when-it-may-not-be-the-best-tool" class="level3">
<h3 class="anchored" data-anchor-id="when-it-may-not-be-the-best-tool">When it may not be the best tool:</h3>
<ul>
<li>For polished multilayer map creation — one option is to use a desktop GIS like QGIS.</li>
<li>If you need very high performance —&nbsp;geopandas can be slow compared to other GIS software.</li>
</ul>
</section>
</section>
<section id="part-2-spatial-relationships-and-joins" class="level2">
<h2 class="anchored" data-anchor-id="part-2-spatial-relationships-and-joins">Part 2: Spatial Relationships and Joins</h2>
<p>Let’s explore joins and merges between GeoDataFrames based on geospatial relationships…</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load some cities data from the data/ folder</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>cities <span class="op">=</span> gpd.read_file(<span class="st">"./data/ne_110m_populated_places"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Vatican City</td>
<td>POINT (12.45339 41.90328)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>San Marino</td>
<td>POINT (12.44177 43.93610)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Vaduz</td>
<td>POINT (9.51667 47.13372)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Lobamba</td>
<td>POINT (31.20000 -26.46667)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Luxembourg</td>
<td>POINT (6.13000 49.61166)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">238</td>
<td>Rio de Janeiro</td>
<td>POINT (-43.22697 -22.92308)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">239</td>
<td>São Paulo</td>
<td>POINT (-46.62697 -23.55673)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">240</td>
<td>Sydney</td>
<td>POINT (151.18323 -33.91807)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">241</td>
<td>Singapore</td>
<td>POINT (103.85387 1.29498)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">242</td>
<td>Hong Kong</td>
<td>POINT (114.18306 22.30693)</td>
</tr>
</tbody>
</table>

<p>243 rows × 2 columns</p>
</div>
</div>
</div>
<center>
<img src="imgs/spatial-relationships.png" width="600">
</center>
<p>(Image by <a href="https://en.wikipedia.org/wiki/Spatial_relation#/media/File:TopologicSpatialRelarions2.png">Krauss, CC BY-SA 3.0</a>)</p>
<p>All of these operations are available as functions of a <code>GeoDataFrame</code>.</p>
<section id="a-quick-example" class="level3">
<h3 class="anchored" data-anchor-id="a-quick-example">A quick example</h3>
<p>What country is New York in?</p>
<p><strong>Spoiler</strong>: the USA</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the Point representing New York City</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>new_york <span class="op">=</span> cities.loc[cities[<span class="st">"name"</span>] <span class="op">==</span> <span class="st">"New York"</span>].geometry.squeeze()</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>new_york</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<p><img src="lecture-3B_files/figure-html/cell-42-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(new_york)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>shapely.geometry.point.Point</code></pre>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>countries.contains(new_york)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>0      False
1      False
2      False
3      False
4      False
       ...  
172    False
173    False
174    False
175    False
176    False
Length: 177, dtype: bool</code></pre>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the country that contains New York</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>countries.loc[countries.contains(new_york)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">168</td>
<td>USA</td>
<td>United States of America</td>
<td>North America</td>
<td>326625791.0</td>
<td>18560000.0</td>
<td>MULTIPOLYGON (((-122.84000 49.00000, -120.0000...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the geometry column of the country containing NYC</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>USA <span class="op">=</span> countries.loc[countries.contains(new_york)].squeeze().geometry</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<p><img src="lecture-3B_files/figure-html/cell-46-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>.loc[]</code> function can take the index selector as the first argument, and the name of a column as a second argument (separated by a comma)</p>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(USA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>shapely.geometry.multipolygon.MultiPolygon</code></pre>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is New York within the USA?</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>new_york.within(USA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<p><img src="lecture-3B_files/figure-html/cell-49-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>The different functions for checking spatial relationships:</p>
<ul>
<li><code>equals</code></li>
<li><code>contains</code></li>
<li><code>crosses</code></li>
<li><code>disjoint</code></li>
<li><code>intersects</code></li>
<li><code>overlaps</code></li>
<li><code>touches</code></li>
<li><code>within</code></li>
<li><code>covers</code></li>
</ul>
<p>See <a href="https://shapely.readthedocs.io/en/stable/manual.html#predicates-and-relationships">the shapely documentation</a> for an overview of these methods.</p>
</section>
<section id="the-spatial-join-sjoin" class="level3">
<h3 class="anchored" data-anchor-id="the-spatial-join-sjoin">1. The spatial join: <code>sjoin()</code></h3>
<p><strong>SPATIAL JOIN</strong> = merging attributes from two geometry layers based on their spatial relationship</p>
<p>Different parts of this operations:</p>
<ul>
<li>The GeoDataFrame to which we want add information</li>
<li>The GeoDataFrame that contains the information we want to add</li>
<li>The spatial relationship we want to use to match both datasets (<strong>intersects</strong>, <strong>contains</strong>, <strong>within</strong>)</li>
<li>The type of join: <strong>left</strong> or <strong>inner</strong> join</li>
</ul>
<p>In this case, we want to join the <code>cities</code> dataframe, containing <code>Point</code> geometries, with the information of the <code>countries</code> dataframe, containing <code>Polygon</code> geometries.</p>
<p>To match cities with countries, we’ll use the <code>within</code> spatial relationship.</p>
<p>The <a href="https://geopandas.org/reference/geopandas.sjoin.html"><code>geopandas.sjoin()</code></a> function performs this operation:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> gpd.sjoin(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    cities,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    countries,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    predicate<span class="op">=</span><span class="st">"within"</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    lsuffix<span class="op">=</span><span class="st">"city"</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    rsuffix<span class="op">=</span><span class="st">"country"</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>joined.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name_city</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_country</th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name_country</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Vatican City</td>
<td>POINT (12.45339 41.90328)</td>
<td>79.0</td>
<td>ITA</td>
<td>Italy</td>
<td>Europe</td>
<td>62137802.0</td>
<td>2221000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>San Marino</td>
<td>POINT (12.44177 43.93610)</td>
<td>79.0</td>
<td>ITA</td>
<td>Italy</td>
<td>Europe</td>
<td>62137802.0</td>
<td>2221000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Vaduz</td>
<td>POINT (9.51667 47.13372)</td>
<td>9.0</td>
<td>AUT</td>
<td>Austria</td>
<td>Europe</td>
<td>8754413.0</td>
<td>416600.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Lobamba</td>
<td>POINT (31.20000 -26.46667)</td>
<td>152.0</td>
<td>SWZ</td>
<td>Swaziland</td>
<td>Africa</td>
<td>1467152.0</td>
<td>11060.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Luxembourg</td>
<td>POINT (6.13000 49.61166)</td>
<td>97.0</td>
<td>LUX</td>
<td>Luxembourg</td>
<td>Europe</td>
<td>594130.0</td>
<td>58740.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As we can see above, the attributes of the cities (left) and countries (right) have been merged based on whether the city is inside the country.</p>
<p>Let’s select cities in Italy only:</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>cities_in_italy <span class="op">=</span> joined.loc[joined[<span class="st">"name_country"</span>] <span class="op">==</span> <span class="st">"Italy"</span>]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>cities_in_italy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name_city</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_country</th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name_country</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Vatican City</td>
<td>POINT (12.45339 41.90328)</td>
<td>79.0</td>
<td>ITA</td>
<td>Italy</td>
<td>Europe</td>
<td>62137802.0</td>
<td>2221000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>San Marino</td>
<td>POINT (12.44177 43.93610)</td>
<td>79.0</td>
<td>ITA</td>
<td>Italy</td>
<td>Europe</td>
<td>62137802.0</td>
<td>2221000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">226</td>
<td>Rome</td>
<td>POINT (12.48131 41.89790)</td>
<td>79.0</td>
<td>ITA</td>
<td>Italy</td>
<td>Europe</td>
<td>62137802.0</td>
<td>2221000.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Italy</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>italy <span class="op">=</span> countries.loc[countries[<span class="st">"name"</span>] <span class="op">==</span> <span class="st">"Italy"</span>]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>italy.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the first city in the joined data frame (Vatican City)</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the same axes by passing in the ax=ax keyword</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> cities_in_italy.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-53-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="spatial-overlay-operation-overlay" class="level3">
<h3 class="anchored" data-anchor-id="spatial-overlay-operation-overlay">2. Spatial overlay operation: <code>overlay()</code></h3>
<p>We can also perform the “join” operation on the <strong>geometries</strong> rather than just combining <strong>attributes</strong>.</p>
<p>The <code>overlay()</code> function combines geometries, e.g.&nbsp;by taking the intersection of the geometries.</p>
<p>Select all countries in Africa:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>africa <span class="op">=</span> countries.loc[countries[<span class="st">"continent"</span>] <span class="op">==</span> <span class="st">"Africa"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>africa.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>AGO</td>
<td>Angola</td>
<td>Africa</td>
<td>29310273.0</td>
<td>189000.0</td>
<td>MULTIPOLYGON (((23.90415 -11.72228, 24.07991 -...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>BDI</td>
<td>Burundi</td>
<td>Africa</td>
<td>11466756.0</td>
<td>7892.0</td>
<td>POLYGON ((29.34000 -4.49998, 29.27638 -3.29391...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>BEN</td>
<td>Benin</td>
<td>Africa</td>
<td>11038805.0</td>
<td>24310.0</td>
<td>POLYGON ((2.69170 6.25882, 1.86524 6.14216, 1....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>BFA</td>
<td>Burkina Faso</td>
<td>Africa</td>
<td>20107509.0</td>
<td>32990.0</td>
<td>POLYGON ((2.15447 11.94015, 1.93599 11.64115, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>BWA</td>
<td>Botswana</td>
<td>Africa</td>
<td>2214858.0</td>
<td>35900.0</td>
<td>POLYGON ((29.43219 -22.09131, 28.01724 -22.827...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>What is the CRS?</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>africa.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's transform to a CRS that uses meters</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># instead of degrees (EPSG=3857)</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>africa <span class="op">=</span> africa.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>africa.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>&lt;Projected CRS: EPSG:3857&gt;
Name: WGS 84 / Pseudo-Mercator
Axis Info [cartesian]:
- X[east]: Easting (metre)
- Y[north]: Northing (metre)
Area of Use:
- name: World between 85.06°S and 85.06°N.
- bounds: (-180.0, -85.06, 180.0, 85.06)
Coordinate Operation:
- name: Popular Visualisation Pseudo-Mercator
- method: Popular Visualisation Pseudo Mercator
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<p>Plot it:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>africa.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"#b9f2b1"</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-58-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="58">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Important CRS needs to match!</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>cities_3857 <span class="op">=</span> cities.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="59">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of the GeoDataFrame</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>buffered_cities <span class="op">=</span> cities_3857.copy()</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a buffer region of 250 km around all cities</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>buffered_cities[<span class="st">"geometry"</span>] <span class="op">=</span> buffered_cities.<span class="bu">buffer</span>(<span class="fl">250e3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="plot-the-difference-of-the-two-geometries" class="level4">
<h4 class="anchored" data-anchor-id="plot-the-difference-of-the-two-geometries">Plot the difference of the two geometries</h4>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="60">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the difference of the geometry sets</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>diff <span class="op">=</span> gpd.overlay(</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    africa,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    buffered_cities,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"difference"</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>diff.plot(facecolor<span class="op">=</span><span class="st">"#b9f2b1"</span>, ax<span class="op">=</span>ax)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/nhand/mambaforge/envs/musa-550-fall-2023/lib/python3.10/site-packages/shapely/constructive.py:181: RuntimeWarning: invalid value encountered in buffer
  return lib.buffer(
/Users/nhand/mambaforge/envs/musa-550-fall-2023/lib/python3.10/site-packages/shapely/set_operations.py:77: RuntimeWarning: invalid value encountered in difference
  return lib.difference(a, b, **kwargs)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-61-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="61">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data attributes are the same as the first data frame (africa)</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with an updated geometry column</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>diff.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AGO</td>
<td>Angola</td>
<td>Africa</td>
<td>29310273.0</td>
<td>189000.0</td>
<td>MULTIPOLYGON (((2673464.087 -1449571.330, 2441...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BEN</td>
<td>Benin</td>
<td>Africa</td>
<td>11038805.0</td>
<td>24310.0</td>
<td>POLYGON ((100138.898 1231805.081, 138422.412 1...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BFA</td>
<td>Burkina Faso</td>
<td>Africa</td>
<td>20107509.0</td>
<td>32990.0</td>
<td>MULTIPOLYGON (((100138.898 1231805.081, 26368....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BWA</td>
<td>Botswana</td>
<td>Africa</td>
<td>2214858.0</td>
<td>35900.0</td>
<td>POLYGON ((3065120.801 -2659823.621, 3061281.52...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>CAF</td>
<td>Central African Rep.</td>
<td>Africa</td>
<td>5625118.0</td>
<td>3206.0</td>
<td>POLYGON ((1792937.514 836963.765, 1813457.017 ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="plot-the-intersection-of-the-two-geometries" class="level4">
<h4 class="anchored" data-anchor-id="plot-the-intersection-of-the-two-geometries">Plot the intersection of the two geometries</h4>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="62">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The intersection of the geometry sets</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>intersection <span class="op">=</span> gpd.overlay(africa, buffered_cities, how<span class="op">=</span><span class="st">"intersection"</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>intersection.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"#b9f2b1"</span>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/nhand/mambaforge/envs/musa-550-fall-2023/lib/python3.10/site-packages/shapely/constructive.py:181: RuntimeWarning: invalid value encountered in buffer
  return lib.buffer(
/Users/nhand/mambaforge/envs/musa-550-fall-2023/lib/python3.10/site-packages/shapely/set_operations.py:133: RuntimeWarning: invalid value encountered in intersection
  return lib.intersection(a, b, **kwargs)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-63-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="recap-spatial-operations" class="level3">
<h3 class="anchored" data-anchor-id="recap-spatial-operations">Recap: spatial operations</h3>
<ul>
<li><strong>Spatial join</strong>: merge attributes from one data frame to another based on the spatial relationship</li>
<li><strong>Spatial overlay</strong>: creating new geometries based on spatial operation between both data frames (and not combining attributes of both data frames)</li>
</ul>
</section>
</section>
<section id="example-exploring-trash-related-311-tickets-by-neighborhood-in-2020" class="level2">
<h2 class="anchored" data-anchor-id="example-exploring-trash-related-311-tickets-by-neighborhood-in-2020">Example: Exploring trash-related 311 tickets by neighborhood in 2020</h2>
<p>Let’s test out our geospatial skills by exploring data for 311 requests in Philadelphia during the pandemic in 2020. We’ll get started by summarizing the data by month and then dive into examining trends by neighborhood.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Find out more...">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Find out more…
</div>
</div>
<div class="callout-body-container callout-body">
<p>Trash collection was a big concern in Philadelphia when the pandemic began. Check out <a href="https://www.inquirer.com/news/philadephia-trash-recycling-collection-delays-covid-20200806.html">this article</a> in the Philadelphia Inquirer for more details!</p>
</div>
</div>
<p>First, let’s load our data from the <code>data/</code> folder. I downloaded the data from <a href="https://www.opendataphilly.org/dataset/311-service-and-information-requests">OpenDataPhilly</a> for tickets from 2020 and trimmed to those requests that have been categorized as “Rubbish/Recyclable Material Collection”. These are tickets related to missed trash pickup by the City’s Streets Department.</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="63">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data from a CSV file into a pandas DataFrame</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>trash_requests_df <span class="op">=</span> pd.read_csv(</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/trash_311_requests_2020.csv"</span>,  <span class="co"># Use the file path relative to the current folder</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="64">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"number of requests = "</span>, <span class="bu">len</span>(trash_requests_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>number of requests =  47730</code></pre>
</div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="65">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>trash_requests_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">objectid</th>
<th data-quarto-table-cell-role="th">service_request_id</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">status_notes</th>
<th data-quarto-table-cell-role="th">service_name</th>
<th data-quarto-table-cell-role="th">service_code</th>
<th data-quarto-table-cell-role="th">agency_responsible</th>
<th data-quarto-table-cell-role="th">service_notice</th>
<th data-quarto-table-cell-role="th">requested_datetime</th>
<th data-quarto-table-cell-role="th">updated_datetime</th>
<th data-quarto-table-cell-role="th">expected_datetime</th>
<th data-quarto-table-cell-role="th">address</th>
<th data-quarto-table-cell-role="th">zipcode</th>
<th data-quarto-table-cell-role="th">media_url</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">lon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8180042</td>
<td>13269656</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-04-02 19:22:24</td>
<td>2020-04-06 07:02:57</td>
<td>2020-04-06 20:00:00</td>
<td>624 FOULKROD ST</td>
<td>NaN</td>
<td>NaN</td>
<td>40.034389</td>
<td>-75.106518</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8180043</td>
<td>13266979</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-04-02 08:40:53</td>
<td>2020-04-06 07:02:58</td>
<td>2020-04-05 20:00:00</td>
<td>1203 ELLSWORTH ST</td>
<td>NaN</td>
<td>NaN</td>
<td>39.936164</td>
<td>-75.163497</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7744426</td>
<td>13066443</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-02 19:17:55</td>
<td>2020-01-04 05:46:06</td>
<td>2020-01-06 19:00:00</td>
<td>9054 WESLEYAN RD</td>
<td>NaN</td>
<td>NaN</td>
<td>40.058737</td>
<td>-75.018345</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7744427</td>
<td>13066540</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-03 07:01:46</td>
<td>2020-01-04 05:46:07</td>
<td>2020-01-06 19:00:00</td>
<td>2784 WILLITS RD</td>
<td>NaN</td>
<td>NaN</td>
<td>40.063658</td>
<td>-75.022347</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7801094</td>
<td>13089345</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-15 13:22:14</td>
<td>2020-01-16 14:03:29</td>
<td>2020-01-16 19:00:00</td>
<td>6137 LOCUST ST</td>
<td>NaN</td>
<td>NaN</td>
<td>39.958186</td>
<td>-75.244732</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="first-convert-to-a-geodataframe" class="level3">
<h3 class="anchored" data-anchor-id="first-convert-to-a-geodataframe">First, convert to a GeoDataFrame</h3>
<p>Remove the requests missing lat/lon coordinates</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="66">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>trash_requests_df <span class="op">=</span> trash_requests_df.dropna(subset<span class="op">=</span>[<span class="st">"lat"</span>, <span class="st">"lon"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create Point objects for each <code>lat</code> and <code>lon</code> combination.</p>
<p>We can use the helper utility function: <a href="https://geopandas.org/en/stable/docs/reference/api/geopandas.points_from_xy.html"><code>geopandas.points_from_xy()</code></a></p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="67">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>trash_requests_df[<span class="st">"geometry"</span>] <span class="op">=</span> gpd.points_from_xy(</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    trash_requests_df[<span class="st">"lon"</span>], trash_requests_df[<span class="st">"lat"</span>]</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="68">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>trash_requests_df[<span class="st">"geometry"</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>0    POINT (-75.10652 40.03439)
1    POINT (-75.16350 39.93616)
2    POINT (-75.01835 40.05874)
3    POINT (-75.02235 40.06366)
4    POINT (-75.24473 39.95819)
Name: geometry, dtype: geometry</code></pre>
</div>
</div>
<p>Now, let’s create our GeoDataFrame object.</p>
<div class="callout callout-style-default callout-warning callout-titled" title="Important">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Don’t forget to set the CRS manually!</li>
<li>The CRS you specify when creating a GeoDataFrame should tell geopandas what the coordinate system the input data is in.</li>
<li>Usually you will be reading lat/lng coordinates, and will need to specify the crs as EPSG code 4326</li>
<li>You should specify the crs as a string using the syntax: <code>ESPG:4326</code></li>
</ul>
</div>
</div>
<p>Since we’re only using a few EPSG codes in this course, you can usually tell what the CRS is by looking at the values in the Point() objects.</p>
<p>Philadelphia has a latitude of about 40 deg and longitude of about -75 deg.</p>
<p><strong>Our data must be in the usual lat/lng EPSG=4326!</strong></p>
<p><img src="imgs/lat-lng-point-example.png" class="img-fluid"></p>
<p>Finally, let’s create our GeoDataFrame:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="69">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    trash_requests_df, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span><span class="st">"EPSG:4326"</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lets-plot-the-monthly-trash-requests" class="level3">
<h3 class="anchored" data-anchor-id="lets-plot-the-monthly-trash-requests">Let’s plot the monthly trash requests</h3>
<p>Let’s add some new columns based on the “requested_datetime”. Right now, this column is a string, denoted by the dtype “object” in pandas language:</p>
<div class="cell" data-tags="[]" data-execution_count="70">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf[<span class="st">"requested_datetime"</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>0    2020-04-02 19:22:24
1    2020-04-02 08:40:53
2    2020-01-02 19:17:55
3    2020-01-03 07:01:46
4    2020-01-15 13:22:14
Name: requested_datetime, dtype: object</code></pre>
</div>
</div>
<p>We can now use the <code>pd.to_datetime()</code> function to convert to a column of special <code>Datetime</code> objects, which have all sorts of useful functionality.</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the requested datetime to a column of Datetime objects</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf[<span class="st">"requested_datetime_dt"</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    trash_requests_gdf[<span class="st">"requested_datetime"</span>]</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="72">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf[<span class="st">"requested_datetime_dt"</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>0   2020-04-02 19:22:24
1   2020-04-02 08:40:53
2   2020-01-02 19:17:55
3   2020-01-03 07:01:46
4   2020-01-15 13:22:14
Name: requested_datetime_dt, dtype: datetime64[ns]</code></pre>
</div>
</div>
<p><br></p>
<p>It looks like it worked! We have a “datetime64[ns]” dtype for our new column now.</p>
<p>Now that the column is a <code>Datetime</code> Series, it has a special “.dt” attribute. This attribute allows you to quickly extract out parts of the date, e.g., month, day, year, etc., as new columns.</p>
<p>For all of the possible options, see the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/series.html">API docs for pd.Series</a> — take a look at all of the entries that start with <code>pd.Series.dt</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Tip: The strftime() function">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip: The strftime() function
</div>
</div>
<div class="callout-body-container callout-body">
<p>For converting datetime objects to strings in a certain format, we can use the “strftime” function (<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.strftime.html">docs</a>). This uses a special syntax to convert the date object to a string with a specific format.</p>
<p><strong>Helpful reference</strong>: Use <a href="https://strftime.org/">this strftime guide</a> to look up the syntax!</p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="73">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the .dt attribute to extract out the month integer (starting at 0)</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf[<span class="st">"month_int"</span>] <span class="op">=</span> trash_requests_gdf[<span class="st">"requested_datetime_dt"</span>].dt.month</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the month name too — this is what %B means - (use strftime.org to see the codes!)</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf[<span class="st">"month"</span>] <span class="op">=</span> trash_requests_gdf[<span class="st">"requested_datetime_dt"</span>].dt.strftime(<span class="st">"%B"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="74">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">objectid</th>
<th data-quarto-table-cell-role="th">service_request_id</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">status_notes</th>
<th data-quarto-table-cell-role="th">service_name</th>
<th data-quarto-table-cell-role="th">service_code</th>
<th data-quarto-table-cell-role="th">agency_responsible</th>
<th data-quarto-table-cell-role="th">service_notice</th>
<th data-quarto-table-cell-role="th">requested_datetime</th>
<th data-quarto-table-cell-role="th">updated_datetime</th>
<th data-quarto-table-cell-role="th">expected_datetime</th>
<th data-quarto-table-cell-role="th">address</th>
<th data-quarto-table-cell-role="th">zipcode</th>
<th data-quarto-table-cell-role="th">media_url</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">requested_datetime_dt</th>
<th data-quarto-table-cell-role="th">month_int</th>
<th data-quarto-table-cell-role="th">month</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8180042</td>
<td>13269656</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-04-02 19:22:24</td>
<td>2020-04-06 07:02:57</td>
<td>2020-04-06 20:00:00</td>
<td>624 FOULKROD ST</td>
<td>NaN</td>
<td>NaN</td>
<td>40.034389</td>
<td>-75.106518</td>
<td>POINT (-75.10652 40.03439)</td>
<td>2020-04-02 19:22:24</td>
<td>4</td>
<td>April</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8180043</td>
<td>13266979</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-04-02 08:40:53</td>
<td>2020-04-06 07:02:58</td>
<td>2020-04-05 20:00:00</td>
<td>1203 ELLSWORTH ST</td>
<td>NaN</td>
<td>NaN</td>
<td>39.936164</td>
<td>-75.163497</td>
<td>POINT (-75.16350 39.93616)</td>
<td>2020-04-02 08:40:53</td>
<td>4</td>
<td>April</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7744426</td>
<td>13066443</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-02 19:17:55</td>
<td>2020-01-04 05:46:06</td>
<td>2020-01-06 19:00:00</td>
<td>9054 WESLEYAN RD</td>
<td>NaN</td>
<td>NaN</td>
<td>40.058737</td>
<td>-75.018345</td>
<td>POINT (-75.01835 40.05874)</td>
<td>2020-01-02 19:17:55</td>
<td>1</td>
<td>January</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7744427</td>
<td>13066540</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-03 07:01:46</td>
<td>2020-01-04 05:46:07</td>
<td>2020-01-06 19:00:00</td>
<td>2784 WILLITS RD</td>
<td>NaN</td>
<td>NaN</td>
<td>40.063658</td>
<td>-75.022347</td>
<td>POINT (-75.02235 40.06366)</td>
<td>2020-01-03 07:01:46</td>
<td>1</td>
<td>January</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7801094</td>
<td>13089345</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-15 13:22:14</td>
<td>2020-01-16 14:03:29</td>
<td>2020-01-16 19:00:00</td>
<td>6137 LOCUST ST</td>
<td>NaN</td>
<td>NaN</td>
<td>39.958186</td>
<td>-75.244732</td>
<td>POINT (-75.24473 39.95819)</td>
<td>2020-01-15 13:22:14</td>
<td>1</td>
<td>January</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, let’s group by the month integer and month name, and get the size of the groups using the built-in <code>.size()</code> function of the groupby object:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="75">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>totals_by_month <span class="op">=</span> trash_requests_gdf.groupby(</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span>[<span class="st">"month_int"</span>, <span class="st">"month"</span>], as_index<span class="op">=</span><span class="va">False</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>).size()</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>totals_by_month</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month_int</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>January</td>
<td>2710</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>February</td>
<td>2067</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>March</td>
<td>2460</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>April</td>
<td>5778</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>May</td>
<td>6572</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>6</td>
<td>June</td>
<td>6485</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>July</td>
<td>9627</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>8</td>
<td>August</td>
<td>4466</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>9</td>
<td>September</td>
<td>1704</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>10</td>
<td>October</td>
<td>1335</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>11</td>
<td>November</td>
<td>1729</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>12</td>
<td>December</td>
<td>2757</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I’ve used the <code>as_index=False</code> keyword to the <code>groupby()</code> function. This will force the <code>size()</code> function to return a DataFrame instead of having the <code>month</code> column as the index of the resulted groupby operation.</p>
<p>Remember, the columns you group by become the index of the aggregated DataFrame. I often like to have them as columns in the DataFrame instead — the <code>as_index=False</code> flag exists for exactly this problem.</p>
</div>
</div>
</section>
<section id="plot-a-bar-chart-with-seaborn" class="level3">
<h3 class="anchored" data-anchor-id="plot-a-bar-chart-with-seaborn">Plot a bar chart with seaborn</h3>
<p>For making static bar charts with Python, seaborn’s <a href="https://seaborn.pydata.org/generated/seaborn.barplot.html"><code>sns.barplot()</code></a> is usually the best option!</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="76">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize figure/axes</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot!</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"month_int"</span>,</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"size"</span>,</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>totals_by_month,</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#2176d2"</span>,</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(totals_by_month[<span class="st">"month"</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-77-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="reference-lets-improve-the-aesthetics-via-matplotlib" class="level3">
<h3 class="anchored" data-anchor-id="reference-lets-improve-the-aesthetics-via-matplotlib">Reference: Let’s improve the aesthetics via matplotlib</h3>
<p>The trend is clear in the previous chart, but can we do a better job with the aesthetics? Yes!</p>
<p>For reference, here is a common way to clean up charts in matplotlib:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="77">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize figure/axes</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot!</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"month"</span>,</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"size"</span>,</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>totals_by_month,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#2176d2"</span>,</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>    order<span class="op">=</span>[</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"January"</span>,</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"February"</span>,</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"March"</span>,</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"April"</span>,</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"May"</span>,</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"June"</span>,</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"July"</span>,</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"August"</span>,</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"September"</span>,</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"October"</span>,</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"November"</span>,</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"December"</span>,</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>    zorder<span class="op">=</span><span class="dv">999</span>,  <span class="co"># Make sure the bar charts are on top of the grid</span></span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove x/y axis labels</span></span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">""</span>)</span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">""</span>)</span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the yticks to go from 0 to 10,000 with 2,000 step</span></span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(np.arange(<span class="dv">0</span>, <span class="fl">1e4</span> <span class="op">+</span> <span class="dv">1</span>, <span class="fl">2e3</span>))</span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the ytick labels to use a comma and no decimal places</span></span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels([<span class="ss">f"</span><span class="sc">{</span>yval<span class="sc">:,</span><span class="fl">.0</span><span class="er">f</span><span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> yval <span class="kw">in</span> ax.get_yticks()])</span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-38"><a href="#cb104-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate the xticks</span></span>
<span id="cb104-39"><a href="#cb104-39" aria-hidden="true" tabindex="-1"></a>plt.setp(ax.get_xticklabels(), rotation<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb104-40"><a href="#cb104-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-41"><a href="#cb104-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a grid backgrou d</span></span>
<span id="cb104-42"><a href="#cb104-42" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, axis<span class="op">=</span><span class="st">"y"</span>)</span>
<span id="cb104-43"><a href="#cb104-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-44"><a href="#cb104-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the top and right axes lines</span></span>
<span id="cb104-45"><a href="#cb104-45" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb104-46"><a href="#cb104-46" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb104-47"><a href="#cb104-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-48"><a href="#cb104-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb104-49"><a href="#cb104-49" aria-hidden="true" tabindex="-1"></a>ax.set_title(</span>
<span id="cb104-50"><a href="#cb104-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Philadelphia's Trash-Related 311 Requests in 2020"</span>, weight<span class="op">=</span><span class="st">"bold"</span>, fontsize<span class="op">=</span><span class="dv">16</span></span>
<span id="cb104-51"><a href="#cb104-51" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture-3B_files/figure-html/cell-78-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Takeaway:</strong> A huge spike in trash related tickets over the summer in 2020!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>This example could come in handy for reference as you work on <a href="https://github.com/MUSA-550-Fall-2023/assignment-2">assignment 2</a>, where you will need to create polished and clear visualizations using both matplotlib and seaborn.</p>
</div>
</div>
</section>
</section>
<section id="thats-it" class="level2">
<h2 class="anchored" data-anchor-id="thats-it">That’s it!</h2>
<ul>
<li>We’ll continue our 311 example next week</li>
<li>More geopandas and geospatial data analysis coming up</li>
<li>See you on Monday next week!</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2023 by <a href="https://www.nickhand.dev">Nick Hand</a>, Quarto layout adapted from <a href="https://github.com/andrewheiss/datavizs23.classes.andrewheiss.com">Andrew Heiss’s Data Visualization with R course</a> <br> All content licensed under a <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc" aria-label="creative-commons-nc"></i> <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Made with <i class="fa-brands fa-python" aria-label="python"></i> and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/MUSA-550-Fall-2023/musa-550-fall-2023.github.io">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></div>
  </div>
</footer>



</body></html>